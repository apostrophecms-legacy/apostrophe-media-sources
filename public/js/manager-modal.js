!function(){var e={849:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}},600:function(e){e.exports=function(e){if(Array.isArray(e))return e}},168:function(e,t,r){var n=r(849);e.exports=function(e){if(Array.isArray(e))return n(e)}},564:function(e){function t(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(o,a){var i=e.apply(r,n);function c(e){t(i,o,a,c,s,"next",e)}function s(e){t(i,o,a,c,s,"throw",e)}c(void 0)}))}}},837:function(e){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},26:function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},258:function(e){e.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}}},284:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},2:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},934:function(e,t,r){var n=r(600),o=r(258),a=r(288),i=r(284);e.exports=function(e,t){return n(e)||o(e,t)||a(e,t)||i()}},918:function(e,t,r){var n=r(168),o=r(26),a=r(288),i=r(2);e.exports=function(e){return n(e)||o(e)||a(e)||i()}},288:function(e,t,r){var n=r(849);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}},264:function(e,t,r){e.exports=r(588)},588:function(e){var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),i=new E(n||[]);return a._invoke=function(e,t,r){var n=p;return function(o,a){if(n===d)throw new Error("Generator is already running");if(n===h){if("throw"===o)throw a;return I()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=O(i,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var s=l(e,t,r);if("normal"===s.type){if(n=r.done?h:f,s.arg===m)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n=h,r.method="throw",r.arg=s.arg)}}}(e,r,i),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p="suspendedStart",f="suspendedYield",d="executing",h="completed",m={};function v(){}function g(){}function y(){}var b={};b[a]=function(){return this};var w=Object.getPrototypeOf,x=w&&w(w(L([])));x&&x!==r&&n.call(x,a)&&(b=x);var k=y.prototype=v.prototype=Object.create(b);function $(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function r(o,a,i,c){var s=l(e[o],e,a);if("throw"!==s.type){var u=s.arg,p=u.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(p).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(s.arg)}var o;this._invoke=function(e,n){function a(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(a,a):a()}}function O(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=l(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,m;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function L(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:I}}function I(){return{value:t,done:!0}}return g.prototype=k.constructor=y,y.constructor=g,g.displayName=s(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},$(S.prototype),S.prototype[i]=function(){return this},e.AsyncIterator=S,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new S(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},$(k),s(k,c,"Generator"),k[a]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=L,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:L(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}},t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=r(837),t=r.n(e),n=r(934),o=r.n(n),a=r(264),i=r.n(a),c=r(564),s=r.n(c),u=r(918),l=r.n(u);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?p(Object(n),!0).forEach((function(r){t()(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}apos.define("apostrophe-images-manager-modal",{extend:"apostrophe-pieces-manager-modal",construct:function(e,t){apos.on("refreshImages",(function(t){e.choices=[].concat(l()(t),l()(e.choices)),e.refresh()})),e.manager=apos.docs.getManager(t.name);var r=e.beforeShow;e.beforeShow=function(t){e.$el.on("change",'select[name="media-sources"]',(function(){var t=this,r=this.value;"apostrophe"!==r.toLowerCase()&&(apos.create("media-sources-browser",{action:e.action,body:{provider:r}}),setTimeout((function(){return t.selectedIndex=0}),250))})),r(t)};var n=e.afterRefresh;e.afterRefresh=function(t){var r=e.$el.find("[data-media-sources]"),o=JSON.parse(apos.mediaSourceConnectors).reduce((function(e,t){return"".concat(e,"<option>").concat(t.label,"</option>")}),""),a='<select name="media-sources" '.concat('class="apos-field-input apos-field-input-select"',">\n          <option>Apostrophe</option>\n          ").concat(o,"\n        </select>");r.append(a),n(t)};var o=e.enableButtonEvents;e.enableButtonEvents=function(){e.$el.on("click","[data-focus-"+t.name+"]",(function(t){$(t.target).attr("data-apos-edit-apostrophe-image")&&$(this).find('input[type="checkbox"]').prop("checked")||(t.preventDefault(),e.focusElement($(this)))})),e.$el.on("dblclick","[data-edit-dbl-"+t.name+"]",(function(){var r=$(this).attr("data-edit-dbl-"+t.name);e.manager.edit(r)})),o()},e.focusElement=function(t){var r=t.find('input[type="checkbox"]');!r.prop("checked")&&e.chooser&&e.chooser.full||(t.toggleClass("apos-focus"),r.prop("checked",(function(e,t){return!t})),r.trigger("change"),t.toggleClass("apos-focus",r.prop("checked")))};var a=e.displayChoiceInCheckbox;e.displayChoiceInCheckbox=function(e,t){var r=a(e,t);return r.parent("label").toggleClass("apos-focus",t),r.closest("[data-piece]").toggleClass("apos-focus",t),r}}}),apos.define("media-sources-browser",{extend:"apostrophe-modal",source:"media-sources-browser",construct:function(e,t){e.results=[],e.choices=[],e.currentPage=1,e.totalPages=0,e.resizeContentHeight=function(){},e.beforeShow=function(){var t=s()(i().mark((function t(r){var n,a,c;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=function(){var t=e.$el.find("[data-script-element]"),r=o()(t,1)[0];apos.emit("".concat(e.mediaSourceConnector.script.name,"Loaded"),{domElement:r,mediaSourceConnector:e.mediaSourceConnector})},e.$manageView=e.$el.find("[data-apos-manage-view]"),e.$filters=e.$modalFilters.find("[data-filters]"),e.$items=e.$el.find("[data-items]"),e.$searchInput=e.$el.find(".apos-modal-filters-search [data-media-sources-filter]")[0],e.provider=e.$el.find("[data-provider]")[0].innerHTML,n=JSON.parse(apos.mediaSourceConnectors),e.mediaSourceConnector=n.find((function(t){return t.label===e.provider})),!e.mediaSourceConnector.script){t.next=11;break}return window[e.mediaSourceConnector.script.name]?c():((a=document.createElement("script")).src=e.mediaSourceConnector.script.src,document.body.appendChild(a),a.addEventListener("load",c)),t.abrupt("return",r());case 11:return e.enableCheckboxEvents(),e.enableInputsEvents(),e.disableOrEnableFilters(),t.next=16,e.requestMediaSource();case 16:e.link("apos-import",s()(i().mark((function t(){var r,n,o;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.choices.length){t.next=3;break}return t.abrupt("return");case 3:return apos.notify("Download started.",{dismiss:!0}),apos.ui.globalBusy(!0),r=e.choices.map((function(t){return e.results.find((function(e){return e.mediaSourceId===t}))})),n={files:r,connector:e.mediaSourceConnector.name},t.next=10,apos.utils.post("".concat(e.mediaSourceConnector.action,"/download"),n);case 10:o=t.sent,apos.emit("refreshImages",o),apos.notify("Download succeeded.",{type:"success",dismiss:!0}),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),apos.notify("There has been an error. Please, retry later.",{type:"error"});case 18:apos.ui.globalBusy(!1);case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))),r();case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.enableInputsEvents=function(){e.$filters.keypress((function(t){13===t.originalEvent.charCode&&e.requestMediaSource()})),$(document).keydown((function(t){var r=t.originalEvent;if(37===r.keyCode){var n=1===e.currentPage;e.requestMediaSource(n?e.totalPages:e.currentPage-1)}else if(39===r.keyCode){var o=e.currentPage===e.totalPages;e.requestMediaSource(o?1:e.currentPage+1)}})),e.$el.on("change","select[data-media-sources-filter]",(function(){e.requestMediaSource()})),e.$el.on("input","input[data-media-sources-filter]",function(e,t,r){var n,o=arguments,a=this;return function(){var c=a,s=o,u=r&&!n;clearTimeout(n),n=setTimeout(i,t),u&&e.apply(c,s)};function i(t,o){n=null,!r&&e.apply(t,o)}}((function(){var t=!e.$searchInput.value.length;e.disableOrEnableFilters(t,"search"),e.requestMediaSource()}),500))},e.disableOrEnableFilters=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1?arguments[1]:void 0,n=[].concat(l()(e.mediaSourceConnector.standardFilters||[]),l()(e.mediaSourceConnector.customFilters||[]));n.forEach((function(n){if(n.dependsOn){var o=e.$filters.find('[name="'.concat(n.name,'"]')).first();r||o.prop("disabled",t),r&&n.dependsOn.includes("search")&&("select-one"===o.prop("type")&&t&&(o[0].selectedIndex=0),o.prop("disabled",t))}}))},e.checkSelectAll=function(){var t=e.$filters.find('input[type="checkbox"][name="select-all"]'),r=o()(t,1)[0];$(r).prop("checked",e.choices.length===e.results.length)},e.enableCheckboxEvents=function(){var t;e.$el.on("change",'input[type="checkbox"][name="select-all"]',(function(t){var r=t.currentTarget;e.$el.find("[data-piece]").each((function(e,t){void 0===$(t).data("imported")&&$(t).find('input[type="checkbox"]').prop("checked",r.checked).trigger("change")})),e.toggleImportButton(),e.checkSelectAll()})),e.$el.on("change",'[data-piece] input[type="checkbox"]',(function(t){var r=t.currentTarget,n=$(r),o=n.parent().parent(),a=n.closest("[data-piece]").attr("data-media-source-id");o.toggleClass("apos-focus",r.checked),e.addOrRemoveChoice(a,!r.checked)})),e.$el.on("click","[data-piece]",(function(r){r.preventDefault();var n=$(r.currentTarget).find('input[type="checkbox"]'),a=o()(n,1)[0],i=$(a);if(i.prop("checked",!a.checked),i.trigger("change"),t){if(r.shiftKey)if(a.checked){var c=i.closest("[data-items]").find("input")||[],s=c.index(a),u=c.index(t);c.slice(Math.min(s,u),Math.max(s,u)+1).each((function(e,t){$(t).prop("checked")||($(t).prop("checked",!0),$(t).trigger("change"))}))}else{var l=e.$el.find("[data-piece]"),p=$(r.currentTarget).attr("data-media-source-id");l.each((function(e,t){$(t).attr("data-media-source-id")!==p&&$(t).find('input[type="checkbox"]').prop("checked",!1).trigger("change")}))}e.toggleImportButton(),e.checkSelectAll(),t=a}else t=a}))},e.toggleImportButton=function(){var t=e.$el.find("[data-apos-import]");e.choices.length?t.removeClass("apos-button--disabled"):t.addClass("apos-button--disabled")},e.addOrRemoveChoice=function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r?e.choices=e.choices.filter((function(e){return e!==t})):e.choices.includes(t)||e.choices.push(t)},e.requestMediaSource=s()(i().mark((function t(){var r,n,o,a,c,s,u,l,p,d=arguments;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.length>0&&void 0!==d[0]?d[0]:1,t.prev=1,n=f(f({},e.getFormData(e.$filters)),{},{page:r,connector:e.mediaSourceConnector.name}),t.next=5,apos.utils.post("".concat(e.mediaSourceConnector.action,"/find"),n);case 5:o=t.sent,a=o.images,c=a.results,s=a.total,u=a.totalPages,l=o.existingIds,p=o.filterChoices,e.currentPage=r,e.totalPages=u,e.results=c,e.injectResultsLabel(c.length,s,r),e.injectResultsList(c,l),e.injectResultsPager({current:r,total:u}),e.updateFiltersChoices(p),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(1),apos.notify("There has been an error. Please, retry later.",{type:"error"});case 24:case"end":return t.stop()}}),t,null,[[1,21]])}))),e.updateFiltersChoices=function(t){e.$filters.find("select.apos-field-input").each((function(e,r){var n=$(r),o=t[r.name].reduce((function(e,t){var r="".concat(e.selectOptions,"<option value=").concat(t.value,">").concat(t.label,"</option>");return t.value===n.val()?{value:t.value,selectOptions:r}:f(f({},e),{},{selectOptions:r})}),{selectOptions:"",value:""}),a=o.selectOptions,i=o.value;n.empty(),n.append(a),n.val(i)}))},e.afterShow=function(t){return e.$searchInput&&e.$searchInput.focus(),t},e.getFormData=function(){var t=e.$filters.find("[data-media-sources-filter]"),r={};return t.each((function(){this.value&&(r[this.name]=this.value)})),r},e.injectResultsLabel=function(t,r,n){var o=e.$el.find("[data-result-label]"),a=e.mediaSourceConnector,i=a.perPage,c=a.totalResults,s=1!==n&&t<i;if(!t)return o.empty(),void o.append("No Results");var u=s?r:n*i,l=u-(t-1),p=r>c?" (Results have been limited around ".concat(c,")"):"";o.empty(),o.append("Showing ".concat(l," - ").concat(u," of ").concat(r).concat(p))},e.injectResultsList=function(t,r){var n=t.reduce((function(t,n){var o=r.includes(n.mediaSourceId);return"\n          ".concat(t,"\n          ").concat(e.getHtmlListItem(n,o),"\n        ")}),"");e.$items.empty(),e.$items.append(n),e.$items.find(".apos-manage-grid-piece").each((function(t,r){var n=$(r).find(".apos-manage-grid-piece-controls button");$(n).on("click",(function(t){t.stopPropagation();var n=$(r).data("media-source-id"),o=$(r).data("imported"),a=e.results.find((function(e){return e.mediaSourceId===n}));apos.create("media-sources-preview",{action:e.action,transition:"slide",body:{item:a,provider:e.body.provider,isImported:void 0!==o}})}))}))},e.getHtmlListItem=function(e,t){return'<div class="apos-manage-grid-piece" data-piece data-media-source-id="'.concat(e.mediaSourceId,'" ').concat(t?"data-imported":"",'>\n      <div class="apos-manage-grid-image">\n        <img src="').concat(e.thumbLink,'" alt="image from Unsplash" />\n        <div class="apos-image-screen" />\n        <div class="apos-manage-grid-piece-controls">\n          <button class="apos-button apos-button--minor">\n            Info\n          <i class="fa fa-caret-right" />\n          </button>\n        </div>\n      </div>\n      <div class="apos-manage-grid-piece-label">').concat(e.title,"</div>\n      ").concat(t?"":'<label>\n        <input type="checkbox" class="apos-field-input apos-field-input-checkbox" />\n        <span class="apos-field-input-checkbox-indicator"></span>\n      </label>',"\n    </div>")},e.injectResultsPager=function(t){var r=t.current,n=t.total,o=e.$el.find("[data-media-sources-pager]"),a=e.getHtmlPager({current:r,total:n});o.empty(),o.append(a),o.find("[data-apos-page]").each((function(t,r){var n=$(r).data("apos-page");$(r).on("click",(function(){e.requestMediaSource(n)}))}))},e.getHtmlPagerItem=function(e){var t=e.num,r=e.isLast,n=e.isActive,o=e.isFirst;return'<span class="apos-pager-number'.concat(o?" apos-first":"").concat(r?" apos-last":"").concat(n?" apos-active":"",'">').concat(n?t:"<a data-apos-page=".concat(t,">").concat(t,"</a>"),"</span>")},e.getHtmlPager=function(t){var r=t.current,n=t.total;if(!e.results.length)return e.getHtmlPagerItem({num:1,isActive:!0});var o=n<6?n:6,a=n>6;return l()(Array(o+(a?2:0)).keys()).reduce((function(t,i){var c=i+1,s=a?'<span class="apos-pager-gap">...</span>':"",u=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];switch(c){case 2:return e?n-4:r-2;case 3:return e?n-3:r-1;case 4:return e?n-2:r;case 5:return e?n-1:r+1;case 6:return e?n:r+2}};if(a){if(r>4&&r<=n-4){var l=u();if(l)return"".concat(t).concat(2===c?s:"").concat(e.getHtmlPagerItem({num:l,isActive:l===r}))}if(r>n-4){var p=u(!0);if(p)return"".concat(t).concat(2===c?s:"").concat(e.getHtmlPagerItem({num:p,isActive:p===r}));if(c>6)return t}else{if(c===o+1)return"".concat(t).concat(s);if(c===o+2)return"".concat(t).concat(e.getHtmlPagerItem({num:n,isLast:!0}))}}var f=e.getHtmlPagerItem({num:c,isActive:c===r,isFirst:1===c});return"".concat(t).concat(f)}),"")}}}),apos.define("media-sources-preview",{extend:"apostrophe-modal",transition:"slide",source:"media-sources-preview",construct:function(e,t){var r=e.beforeShow;e.beforeShow=function(){var t=s()(i().mark((function t(n){var o;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.$form=e.$el.find("[data-apos-form]"),e.provider=e.$form.attr("data-provider"),e.item=JSON.parse(e.$form.attr("data-item")),o=JSON.parse(apos.mediaSourceConnectors),e.mediaSourceConnector=o.find((function(t){return t.label===e.provider})),e.link("apos-import",s()(i().mark((function t(){var r,n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,apos.notify("Download started.",{dismiss:!0}),apos.ui.globalBusy(!0),r={files:[e.item],connector:e.mediaSourceConnector.name},t.next=6,apos.utils.post("".concat(e.mediaSourceConnector.action,"/download"),r);case 6:n=t.sent,apos.emit("refreshImages",n),apos.notify("Download succeeded.",{type:"success",dismiss:!0}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),apos.notify("There has been an error. Please, retry later.",{type:"error"});case 14:apos.ui.globalBusy(!1),e.cancel();case 16:case"end":return t.stop()}}),t,null,[[0,11]])})))),r(n());case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})}()}();